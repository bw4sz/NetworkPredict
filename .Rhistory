newModel<-T
ggplot(species.mean) + geom_ribbon(alpha=0.4,aes(x=TotalCorolla,ymin=phi_low,ymax=phi_high,fill=r)) + theme_bw() + facet_wrap(~Hummingbird,scales="free",ncol=3)+ ggtitle("Niche Breadth") + geom_vline(aes(xintercept=Total_Culmen),linetype='dashed') + geom_line(aes(x=TotalCorolla,y=phi,fill=r)) + ylab("Probability of Interaction") + xlab("Corolla Length (mm)") + scale_fill_manual("Resource Availability",values=c("Blue","Red")) + ylim(0,1)
sindat
runs<-200000
runs*.95
17316.957/60
17316.957/60/60
library(reshape2)
library(foreach)
library(doSNOW)
library(chron)
library(ggplot2)
library(knitr)
library(R2jags)
library(dplyr)
library(stringr)
library(gridExtra)
library(boot)
library(picante)
library(bipartite)
library(lme4)
opts_chunk$set(message=FALSE,warning=FALSE,fig.width=10,fig.height=7,echo=TRUE,cache=F,fig.align='center',fig.path="figureObserved/")
#new model update
newModel<-F
load("ObservedModel.RData")
nsplit<-split(species.mean,species.mean$r)
makeR<-function(x){
#input matrix
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rbinom(1,1,prob=x[j,"phi"])
}
aggm<-melt(aggm)
colnames(aggm)<-c("jBird","jPlant","P")
tomerge<-species.mean %>% group_by(jBird,jPlant,Corolla,Hummingbird,Traitmatch) %>% distinct()
aggm<-merge(aggm,tomerge)
rangestat<-aggm %>% group_by(Hummingbird) %>% summarize(mean=mean(Corolla),lower=quantile(Corolla,0.05),higher=quantile(Corolla,0.95))
return(rangestat)
}
nstat<-lapply(nsplit,function(x){
netstat<-melt(lapply(1:10,function(k) makeR(x)))
colnames(netstat)<-c("Hummingbird","Metric","value","Iteration")
return(netstat)
})
names(nstat)<-c("Low","High")
nstat<-melt(nstat,colnames(nstat[[1]]))
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=1) + scale_fill_discrete("Resource Availability") + theme_bw()
species.mean %>% group_by(Hummingbird,r) %>% summarize(mean(phi))
nsplit<-split(species.mean,species.mean$r)
makeR<-function(x){
#input matrix
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rbinom(1,1,prob=x[j,"phi"])
}
aggm<-melt(aggm)
colnames(aggm)<-c("jBird","jPlant","P")
tomerge<-species.mean %>% select(jBird,jPlant,Corolla,Hummingbird,Traitmatch) %>% distinct()
aggm<-merge(aggm,tomerge)
rangestat<-aggm %>% group_by(Hummingbird) %>% summarize(mean=mean(Corolla),lower=quantile(Corolla,0.05),higher=quantile(Corolla,0.95))
return(rangestat)
}
nstat<-lapply(nsplit,function(x){
netstat<-melt(lapply(1:10,function(k) makeR(x)))
colnames(netstat)<-c("Hummingbird","Metric","value","Iteration")
return(netstat)
})
names(nstat)<-c("Low","High")
nstat<-melt(nstat,colnames(nstat[[1]]))
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=1) + scale_fill_discrete("Resource Availability") + theme_bw()
head(nstat)
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_column(Hummingbird~Metric,scales='free',nrow=1) + scale_fill_discrete("Resource Availability") + theme_bw()
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_grid(Hummingbird~Metric,scales='free',nrow=1) + scale_fill_discrete("Resource Availability") + theme_bw()
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_grid(Hummingbird~Metric,scales='free') + scale_fill_discrete("Resource Availability") + theme_bw()
ggplot(nstat,aes(x=Hummingbird,y=value,col=L1)) + geom_point() + facet_wrap(~Metric)
ggplot(nstat,aes(x=Hummingbird,y=value,col=L1)) + geom_point() + facet_wrap(~Metric,ncol=1)
nsplit<-split(species.mean,species.mean$r)
makeR<-function(x){
#input matrix
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rbinom(1,1,prob=x[j,"phi"])
}
aggm<-melt(aggm)
colnames(aggm)<-c("jBird","jPlant","P")
tomerge<-species.mean %>% select(jBird,jPlant,Corolla,Hummingbird,Traitmatch) %>% distinct()
aggm<-merge(aggm,tomerge)
rangestat<-aggm %>% filter(P==1) %>% group_by(Hummingbird) %>% summarize(mean=mean(Corolla),lower=quantile(Corolla,0.05),higher=quantile(Corolla,0.95))
return(rangestat)
}
nstat<-lapply(nsplit,function(x){
netstat<-melt(lapply(1:10,function(k) makeR(x)))
colnames(netstat)<-c("Hummingbird","Metric","value","Iteration")
return(netstat)
})
names(nstat)<-c("Low","High")
nstat<-melt(nstat,colnames(nstat[[1]]))
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=1) + scale_fill_discrete("Resource Availability") + theme_bw()
ggplot(nstat,aes(x=Hummingbird,y=value,col=L1)) + geom_point() + facet_wrap(~Metric,ncol=1)
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=1) + scale_fill_discrete("Resource Availability") + theme_bw()
ranges<-dcast(nstat ..~metric)
ranges<-dcast(nstat ...~metric)
ranges<-dcast(nstat,...~metric)
ranges<-dcast(nstat,...~Metric)
head(ranges)
nsplit<-split(species.mean,species.mean$r)
makeR<-function(x){
#input matrix
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rbinom(1,1,prob=x[j,"phi"])
}
aggm<-melt(aggm)
colnames(aggm)<-c("jBird","jPlant","P")
tomerge<-species.mean %>% select(jBird,jPlant,Corolla,Hummingbird,Traitmatch) %>% distinct()
aggm<-merge(aggm,tomerge)
return(rangestat)
}
nstat<-lapply(nsplit,function(x){
netstat<-melt(lapply(1:10,function(k) makeR(x)))
colnames(netstat)<-c("Hummingbird","Metric","value","Iteration")
return(netstat)
})
nsplit<-split(species.mean,species.mean$r)
makeR<-function(x){
#input matrix
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rbinom(1,1,prob=x[j,"phi"])
}
aggm<-melt(aggm)
colnames(aggm)<-c("jBird","jPlant","P")
tomerge<-species.mean %>% select(jBird,jPlant,Corolla,Hummingbird,Traitmatch) %>% distinct()
aggm<-merge(aggm,tomerge)
return(aggm)
}
netstat<-melt(lapply(1:10,function(k) makeR(x)))
nsplit<-split(species.mean,species.mean$r)
makeR<-function(x){
#input matrix
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rbinom(1,1,prob=x[j,"phi"])
}
aggm<-melt(aggm)
colnames(aggm)<-c("jBird","jPlant","P")
tomerge<-species.mean %>% select(jBird,jPlant,Corolla,Hummingbird,Traitmatch) %>% distinct()
aggm<-merge(aggm,tomerge)
return(aggm)
}
melt(lapply(1:10,function(k) makeR(x)))
nsplit<-split(species.mean,species.mean$r)
makeR<-function(x){
#input matrix
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rbinom(1,1,prob=x[j,"phi"])
}
aggm<-melt(aggm)
colnames(aggm)<-c("jBird","jPlant","P")
tomerge<-species.mean %>% select(jBird,jPlant,Corolla,Hummingbird,Traitmatch) %>% distinct()
aggm<-merge(aggm,tomerge)
return(aggm)
}
x<-nsplit[[1]]
netstat<-melt(lapply(1:10,function(k) makeR(x)))
head(netstat)
lapply(1:10,function(k) makeR(x))
makeR(x)
melt(makeR(x))
head(melt(makeR(x))_
head(melt(makeR(x)))
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch"))
head(netstat)
nstat<-lapply(nsplit,function(x){
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch"))
return(netstat)
})
head(nstat)
names(nstat)<-c("Low","High")
nstat<-melt(nstat,colnames(nstat[[1]]))
head(nstat)
rangestat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1) %>% summarize(mean=mean(Corolla),lower=quantile(Corolla,0.05),higher=quantile(Corolla,0.95))
rangestat<-nstat %>% filter(value==1) %>% group_by(Hummingbird,L1) %>% summarize(mean=mean(Corolla),lower=quantile(Corolla,0.05),higher=quantile(Corolla,0.95))
nstat<-lapply(nsplit,function(x){
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch","Corolla"))
return(netstat)
})
names(nstat)<-c("Low","High")
nstat<-melt(nstat,colnames(nstat[[1]]))
head(nstat)
rangestat<-nstat %>% filter(value==1) %>% group_by(Hummingbird,L1) %>% summarize(mean=mean(Corolla),lower=quantile(Corolla,0.05),higher=quantile(Corolla,0.95))
rangestat
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=1) + scale_fill_discrete("Resource Availability") + theme_bw()
head(nstat)
ggplot(nstat[nstat$value==1,],aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=1) + scale_fill_discrete("Resource Availability") + theme_bw()
ggplot(nstat[nstat$value==1,],aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Hummingbird,scales='free',nrow=1) + scale_fill_discrete("Resource Availability") + theme_bw()
ggplot(nstat[nstat$value==1,],aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Hummingbird,scales='free',nrow=4) + scale_fill_discrete("Resource Availability") + theme_bw()
```{r}
ggplot(nstat[nstat$value==1,],aes(x=Corolla,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Hummingbird,scales='free',nrow=4) + scale_fill_discrete("Resource Availability") + theme_bw()
ggplot(nstat[nstat$value==1,],aes(x=Corolla,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Hummingbird,scales='free',nrow=5) + scale_fill_discrete("Resource Availability") + theme_bw()
rangestat<-nstat %>% filter(value==1) %>% group_by(Hummingbird,L1) %>% summarize(mean=mean(Corolla),lower=quantile(Corolla,0.05),higher=quantile(Corolla,0.95))
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=,col=L1)) + geom_pointrange()
rangestat<-nstat %>% filter(value==1) %>% group_by(Hummingbird,L1) %>% summarize(mean=mean(Corolla),lower=quantile(Corolla,0.05),upper=quantile(Corolla,0.95))
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=,col=L1)) + geom_pointrange()
rangestat
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=,col=L1)) + geom_linerange()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange() + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange() + coord_flip() + facet_wrap(~HUmmingbird)
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange() + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange() + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange() + geom_point() + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange() + geom_point(aes(y=mean)) + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange(alpha=0.5) + geom_point(aes(y=mean)) + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange(alpha=0.5) + geom_point(aes(y=mean)) + coord_flip() + labs("Resource Availability")
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange(alpha=0.5) + geom_point(aes(y=mean)) + coord_flip() + labs("Resource Availability") + theme_bw()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange(alpha=0.5) + geom_point(aes(y=mean)) + coord_flip() + labs(fill="Resource Availability") + theme_bw()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange(alpha=0.5,position = position_stack()) + geom_point(aes(y=mean)) + coord_flip() + labs(fill="Resource Availability") + theme_bw()
?position_dodge
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange(alpha=0.5,position="dodge") + geom_point(aes(y=mean)) + labs(fill="Resource Availability") + theme_bw()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange(alpha=0.5,position=position_dodge(width=10)) + geom_point(aes(y=mean)) + labs(fill="Resource Availability") + theme_bw()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange(alpha=0.5,position=position_dodge(width=11)) + geom_point(aes(y=mean)) + labs(fill="Resource Availability") + theme_bw()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange(alpha=0.5,position=position_dodge(width=11)) + geom_point(aes(y=mean)) + labs(fill="Resource Availability") + theme_bw() + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange(alpha=0.5,position=position_dodge(width=1)) + geom_point(aes(y=mean)) + labs(fill="Resource Availability") + theme_bw() + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange(alpha=0.5,position=position_dodge(width=.1)) + geom_point(aes(y=mean)) + labs(fill="Resource Availability") + theme_bw() + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1),size=2) + geom_linerange(alpha=0.5,position=position_dodge(width=.5)) + geom_point(aes(y=mean)) + labs(fill="Resource Availability") + theme_bw() + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.5),size=2) + geom_point(aes(y=mean)) + labs(fill="Resource Availability") + theme_bw() + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean)) + labs(fill="Resource Availability") + theme_bw() + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position_dodge(width=.75)) + labs(fill="Resource Availability") + theme_bw() + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(fill="Resource Availability") + theme_bw() + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(col="Resource Availability") + theme_bw() + coord_flip()
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(col="Resource Availability") + theme_bw() + coord_flip() + theme(legend.position="bottom")
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(col="Resource Availability",y="Corolla Length(mm)") + theme_bw() + coord_flip() + theme(legend.position="bottom")
head(nstat)
tail(nstat)
head(netstat)
colnames(netstat)
colnames(netstat)[7]
nstat<-lapply(nsplit,function(x){
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch","Corolla"))
colnames(netstat)[7]<-"Iteration"
return(netstat)
})
names(nstat)<-c("Low","High")
nstat<-melt(nstat,colnames(nstat[[1]]))
head(nsta)
head(nstat)
nsplit<-split(species.mean,species.mean$r)
makeR<-function(x){
#input matrix
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rbinom(1,1,prob=x[j,"phi"])
}
aggm<-melt(aggm)
colnames(aggm)<-c("jBird","jPlant","P")
tomerge<-species.mean %>% select(jBird,jPlant,Corolla,Hummingbird,Traitmatch) %>% distinct()
aggm<-merge(aggm,tomerge)
return(aggm)
}
nstat<-lapply(nsplit,function(x){
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch","Corolla"))
colnames(netstat)[7]<-"Iteration"
return(netstat)
})
names(nstat)<-c("Low","High")
nstat<-melt(nstat,colnames(nstat[[1]]))
ggplot(nstat[nstat$value==1,],aes(x=Corolla,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Hummingbird,scales='free',nrow=5) + scale_fill_discrete("Resource Availability") + theme_bw()
head(nstat)
nsplit<-split(species.mean,species.mean$r)
makeR<-function(x){
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
#input matrix
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rbinom(1,1,prob=x[j,"phi"])
aggm<-melt(aggm)
colnames(aggm)<-c("jBird","jPlant","P")
}
tomerge<-species.mean %>% select(jBird,jPlant,Corolla,Hummingbird,Traitmatch) %>% distinct()
return(aggm)
aggm<-merge(aggm,tomerge)
}
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch","Corolla"))
x<-nsplit[[1]]
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch","Corolla"))
k<-nsplit[[1]]
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch","Corolla"))
k
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch","Corolla"))
x<-nsplit[[1]]
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch","Corolla"))
lapply(1:10,function(k) makeR(x))
nsplit<-split(species.mean,species.mean$r)
x<-nsplit[[1]]
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch","Corolla"))
makeR(x)
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rbinom(1,1,prob=x[j,"phi"])
}
aggm<-melt(aggm)
colnames(aggm)<-c("jBird","jPlant","P")
tomerge<-species.mean %>% select(jBird,jPlant,Corolla,Hummingbird,Traitmatch) %>% distinct()
aggm<-merge(aggm,tomerge)
haed(aggm)
head(aggm)
makeR(x)
dim(x)
nsplit<-split(species.mean,species.mean$r)
makeR<-function(x){
#input matrix
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rbinom(1,1,prob=x[j,"phi"])
}
aggm<-melt(aggm)
colnames(aggm)<-c("jBird","jPlant","P")
tomerge<-species.mean %>% select(jBird,jPlant,Corolla,Hummingbird,Traitmatch) %>% distinct()
aggm<-merge(aggm,tomerge)
return(aggm)
}
nsplit
nsplit[[1]]
lapply(1:10,function(k) makeR(x))
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch","Corolla"))
head(netstat)
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch","Corolla","P"))
head(netstat)
nsplit<-split(species.mean,species.mean$r)
makeR<-function(x){
#input matrix
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rbinom(1,1,prob=x[j,"phi"])
}
aggm<-melt(aggm)
colnames(aggm)<-c("jBird","jPlant","P")
tomerge<-species.mean %>% select(jBird,jPlant,Corolla,Hummingbird,Traitmatch) %>% distinct()
aggm<-merge(aggm,tomerge)
return(aggm)
}
nstat<-lapply(nsplit,function(x){
netstat<-melt(lapply(1:10,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch","Corolla","P"))
colnames(netstat)[7]<-"Iteration"
return(netstat)
})
names(nstat)<-c("Low","High")
nstat<-melt(nstat,colnames(nstat[[1]]))
ggplot(nstat[nstat$P==1,],aes(x=Corolla,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Hummingbird,scales='free',nrow=5) + scale_fill_discrete("Resource Availability") + theme_bw()
rangestat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1) %>% summarize(mean=mean(Corolla),lower=quantile(Corolla,0.05),upper=quantile(Corolla,0.95))
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(col="Resource Availability",y="Corolla Length (mm)") + theme_bw() + coord_flip() + theme(legend.position="bottom")
rangestat<-nstat %>% filter(value==1) %>% group_by(Hummingbird,L1) %>% summarize(mean=mean(Corolla),lower=quantile(Corolla,0.05),upper=quantile(Corolla,0.95))
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(col="Resource Availability",y="Corolla Length (mm)") + theme_bw() + coord_flip() + theme(legend.position="bottom")
head(nsta)
head(nstat)
nstat %>% filter(value==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(mean=mean(Corolla))
rangestat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(mean=mean(Corolla))
nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(mean=mean(Corolla))
rangestat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(mean=mean(Corolla)) %>% summarize(mean(mean),lower=quantile(mean,0.05),upper=quantile(mean,0.95))
meanstat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(mean=mean(Corolla)) %>% summarize(mean(mean),lower=quantile(mean,0.05),upper=quantile(mean,0.95))
ggplot(meanstat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(col="Resource Availability",y="Corolla Length (mm)") + theme_bw() + coord_flip() + theme(legend.position="bottom")
meanstat
meanstat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(mean=mean(Corolla)) %>% summarize(mean=mean(mean),lower=quantile(mean,0.05),upper=quantile(mean,0.95))
ggplot(meanstat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(col="Resource Availability",y="Corolla Length (mm)") + theme_bw() + coord_flip() + theme(legend.position="bottom")
head(meanstat)
head(nstat)
tail(nstat)
meanstat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(mean=mean(Corolla)) %>% summarize(mean=mean(mean),lower=quantile(mean,0.05),upper=quantile(mean,0.95))
meanstat
meanstat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(mean=mean(Corolla))
meanstat
meanstat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(mean=mean(Corolla))%>% summarize(mean=mean(mean),lower=quantile(mean,0.05),upper=quantile(mean,0.95))
meanstat
meanstat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(a=mean(Corolla))%>% summarize(mean=mean(a),lower=quantile(a,0.05),upper=quantile(a,0.95))
meanstat
ggplot(meanstat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(col="Resource Availability",y="Corolla Length (mm)") + theme_bw() + coord_flip() + theme(legend.position="bottom")
meanstat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(a=min(Corolla))%>% summarize(mean=mean(a),lower=quantile(a,0.05),upper=quantile(a,0.95))
ggplot(meanstat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(col="Resource Availability",y="Corolla Length (mm)") + theme_bw() + coord_flip() + theme(legend.position="bottom")
nsplit<-split(species.mean,species.mean$r)
makeR<-function(x){
#input matrix
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rbinom(1,1,prob=x[j,"phi"])
}
aggm<-melt(aggm)
colnames(aggm)<-c("jBird","jPlant","P")
tomerge<-species.mean %>% select(jBird,jPlant,Corolla,Hummingbird,Traitmatch) %>% distinct()
aggm<-merge(aggm,tomerge)
return(aggm)
}
nstat<-lapply(nsplit,function(x){
netstat<-melt(lapply(1:50,function(k) makeR(x)),id.vars=c("jBird","jPlant","Hummingbird","Traitmatch","Corolla","P"))
colnames(netstat)[7]<-"Iteration"
return(netstat)
})
names(nstat)<-c("Low","High")
nstat<-melt(nstat,colnames(nstat[[1]]))
ggplot(nstat[nstat$P==1,],aes(x=Corolla,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Hummingbird,scales='free',nrow=5) + scale_fill_discrete("Resource Availability") + theme_bw()
rangestat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1) %>% summarize(mean=mean(Corolla),lower=quantile(Corolla,0.05),upper=quantile(Corolla,0.95))
ggplot(rangestat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(col="Resource Availability",y="Corolla Length (mm)") + theme_bw() + coord_flip() + theme(legend.position="bottom")
meanstat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(a=mean(Corolla))%>% summarize(mean=mean(a),lower=quantile(a,0.05),upper=quantile(a,0.95))
ggplot(meanstat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(col="Resource Availability",y="Corolla Length (mm)") + theme_bw() + coord_flip() + theme(legend.position="bottom")
meanstat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(a=mean(Corolla))%>% summarize(mean=mean(a),lower=quantile(a,0.05),upper=quantile(a,0.95))
ggplot(meanstat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.6),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.6)) + labs(col="Resource Availability",y="Corolla Length (mm)") + theme_bw() + coord_flip() + theme(legend.position="bottom")
meanstat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(a=min(Corolla))%>% summarize(mean=mean(a),lower=quantile(a,0.05),upper=quantile(a,0.95))
ggplot(meanstat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(col="Resource Availability",y="Corolla Length (mm)") + theme_bw() + coord_flip() + theme(legend.position="bottom")
meanstat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(a=min(Corolla))%>% summarize(mean=mean(a),lower=quantile(a,0.05),upper=quantile(a,0.95))
ggplot(meanstat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.75),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.75)) + labs(col="Resource Availability",y="Corolla Length (mm)") + theme_bw() + coord_flip() + theme(legend.position="bottom")
meanstat<-nstat %>% filter(P==1) %>% group_by(Hummingbird,L1,Iteration) %>% summarize(a=min(Corolla))%>% summarize(mean=mean(a),lower=quantile(a,0.05),upper=quantile(a,0.95))
ggplot(meanstat,aes(x=Hummingbird,ymin=lower,ymax=upper,ymean=mean,col=L1)) + geom_linerange(alpha=0.5,position=position_dodge(width=.6),size=2) + geom_point(aes(y=mean),position=position_dodge(width=.6)) + labs(col="Resource Availability",y="Corolla Length (mm)") + theme_bw() + coord_flip() + theme(legend.position="bottom")
ggplot(indat,aes(x=Traitmatch,y=Yobs,col=as.factor(BUsed_Flowers))) + facet_wrap(~Hummingbird,ncol=4) + geom_point() + geom_smooth(method = "glm",method.args=list(family="binomial")) + scale_color_manual("Resource Availability",values=c('blue','red'))
ggplot(indat,aes(x=Traitmatch,y=Yobs,col=as.factor(BAll_Flowers))) + facet_wrap(~Hummingbird,ncol=4) + geom_point() + geom_smooth(method = "glm",method.args=list(family="binomial")) + scale_color_manual("Resource Availability",values=c('blue','red'))
ggplot(indat[indat$Yobs==1,],aes(x=Traitmatch,fill=as.factor(scaledR))) + facet_wrap(~Hummingbird,ncol=4,scales="free") + geom_density(alpha=.7) + scale_fill_manual("Resource Availability",values=c('blue','red'))
head(indat)
m<-glmer(data=indat,Yobs~Traitmatch*scale(All_Flowers)+(1|Hummingbird),family="binomial")
summary(m)
predy<-trajF(alpha=-1.43,beta1=-0.056,trait=indat$Traitmatch,resources=scale(indat$All_Flowers),beta2=-0.11,beta3=0.001)
predy2<-trajF(alpha=-1.43,beta1=-0.056,trait=indat$Traitmatch,resources=scale(indat$All_Flowers),beta2=0,beta3=0.001)
ggplot(data=predy,aes(x=trait)) + geom_ribbon(aes(ymin=lower,ymax=upper),alpha=0.4,fill="red")  +  theme_bw() + ylab("Interactions") + xlab("Difference between Bill and Corolla Length")  + geom_line(aes(y=mean)) + geom_line(data=predy2,aes(x=trait,y=mean),col="blue")
resourceMatrix
source('~/.active-rstudio-document', echo=TRUE)
flower.month
flower.month[flower.month$Flowers<20,]
flower.month[flower.month$Flowers<25,]
flower.month[flower.month$Month==6 & flower.month$Year==2016,]
full.fl[full.fl$Month==6 & full.fl$Year==2016,]
full.fl[full.fl$Month==6 & full.fl$Year==2016 & full.fl$Transect_R=="1900_2100",]
a<=full.fl[full.fl$Month==6 & full.fl$Year==2016 & full.fl$Transect_R=="1900_2100",]
a<-full.fl[full.fl$Month==6 & full.fl$Year==2016 & full.fl$Transect_R=="1900_2100",]
fix(a)
flower.month[flower.month$Month==6 & flower.month$Year==2016,]
a<-full.fl[full.fl$Month==6 & full.fl$Year==2016 & full.fl$Transect_R=="1900_2100"&full.fl$Date_F =="2016-06-24",]
a
a
source('~/.active-rstudio-document', echo=TRUE)
ggplot(indat,aes(x=Traitmatch,y=Yobs,col=as.factor(BAll_Flowers))) + facet_wrap(~Hummingbird,ncol=4) + geom_point() + geom_smooth(method = "glm",method.args=list(family="Poisson")) + scale_color_manual("Resource Availability",values=c('blue','red'))
warnings()
ggplot(indat,aes(x=Traitmatch,y=Yobs,col=as.factor(BAll_Flowers))) + facet_wrap(~Hummingbird,ncol=4) + geom_point() + geom_smooth(method = "glm",method.args=list(family="poisson")) + scale_color_manual("Resource Availability",values=c('blue','red'))
ggplot(indat,aes(x=Traitmatch,y=Yobs,col=as.factor(BAll_Flowers))) + facet_wrap(~Hummingbird,ncol=4,scales=free) + geom_point() + geom_smooth(method = "glm",method.args=list(family="poisson")) + scale_color_manual("Resource Availability",values=c('blue','red'))
ggplot(indat,aes(x=Traitmatch,y=Yobs,col=as.factor(BAll_Flowers))) + facet_wrap(~Hummingbird,ncol=4,scales="free") + geom_point() + geom_smooth(method = "glm",method.args=list(family="poisson")) + scale_color_manual("Resource Availability",values=c('blue','red'))
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
indat$Yobs
max(indat$Yobs)
source('~/.active-rstudio-document', echo=TRUE)
indat$Yobs
indat$Camera
indat$Transect_R
indat$Transect
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
#Generate network
```{r}
#Split by resource
nsplit<-split(species.mean,species.mean$r)
makeN<-function(x){
#input matrix
aggm<-matrix(nrow=nrow(jagsIndexBird),ncol=nrow(jagsIndexPlants),data=0)
for (j in 1:nrow(x)){
aggm[x[j,"jBird"],x[j,"jPlant"]]<-rpois(1,prob=x[j,"phi"])
}
#calculate network statistic
nstat<-networklevel(aggm,index=c("connectance","nestedness","niche overlap"),level="lower")
}
nstat<-lapply(nsplit,function(x){
netstat<-melt(t(sapply(1:500,function(k) makeN(x))))
colnames(netstat)<-c("Iteration","Metric","value")
return(netstat)
})
names(nstat)<-c("Low","High")
nstat<-melt(nstat,colnames(nstat[[1]]))
ggplot(nstat,aes(x=value,fill=L1)) + geom_density(alpha=0.6) + facet_wrap(~Metric,scales='free',nrow=3) + scale_fill_discrete("Resource Availability") + theme_bw()
ggsave("Figures/NetworkStatistics.jpeg",height=5,width=6,dpi=600)
ggplot(species.mean) + geom_ribbon(alpha=0.5,aes(x=Corolla,ymin=phi_low,ymax=phi_high,fill=r)) + theme_bw() + facet_wrap(~Hummingbird,scales="free",ncol=4)+ ggtitle("Niche Breadth") + geom_vline(aes(xintercept=Total_Culmen),linetype='dashed') + geom_line(aes(x=Corolla,y=phi,fill=r)) + ylab("Probability of Interaction") + xlab("Corolla Length (mm)") + scale_fill_manual("Resource Availability",values=c("Grey","Black"))
save.image("ObservedModel.RData")
?rpois
library(reshape2)
library(foreach)
library(doSNOW)
library(chron)
library(ggplot2)
library(knitr)
library(R2jags)
library(dplyr)
library(stringr)
library(gridExtra)
library(boot)
library(picante)
library(bipartite)
library(lme4)
opts_chunk$set(message=FALSE,warning=FALSE,fig.width=10,fig.height=7,echo=TRUE,cache=F,fig.align='center',fig.path="figureObserved/")
#new model update
newModel<-T
load("Observed.RData")
newModel<-T
source("Bayesian/BayesFunctions.R")
indat<-indat[indat$Survey_Type=="Camera",]
dim(indat)
ggplot(indat,aes(x=Traitmatch,y=Yobs,col=as.factor(BAll_Flowers))) + facet_wrap(~Hummingbird,ncol=4,scales="free") + geom_point() + geom_smooth(method = "glm",method.args=list(family="poisson")) + scale_color_manual("Resource Availability",values=c('blue','red'))
ggplot(indat[indat$Yobs==1,],aes(x=Traitmatch,fill=as.factor(scaledR))) + facet_wrap(~Hummingbird,ncol=4,scales="free") + geom_density(alpha=.7) + scale_fill_manual("Resource Availability",values=c('blue','red'))
m<-glmer(data=indat,Yobs~Traitmatch*scale(All_Flowers)+(1|Hummingbird),family="poisson")
summary(m)
m<-glmer(data=indat[indat$Hummingbird %in% "White-whiskered Hermit",],Yobs~Traitmatch*scale(All_Flowers)+(1|Hummingbird),family="poisson")
m<-glmer(data=indat[c(indat$Hummingbird %in% "White-whiskered Hermit","Tawny-bellied Hermit",],Yobs~Traitmatch*scale(All_Flowers)+(1|Hummingbird),family="poisson")
m<-glmer(data=indat[c(indat$Hummingbird %in% "White-whiskered Hermit","Tawny-bellied Hermit"),],Yobs~Traitmatch*scale(All_Flowers)+(1|Hummingbird),family="poisson")
summary(m)
m<-glmer(data=indat[indat$Hummingbird %in% c("White-whiskered Hermit","Tawny-bellied Hermit"),],Yobs~Traitmatch*scale(All_Flowers)+(1|Hummingbird),family="poisson")
summary(m)
source('~/.active-rstudio-document', echo=TRUE)
